{"ast":null,"code":"/**\n * AcuitySchedulingOAuth Class\n */\nvar AcuityScheduling = require('./AcuityScheduling');\n\nvar querystring = require('querystring');\n\nvar request = require('request');\n\nfunction AcuitySchedulingOAuth(config) {\n  config = config || {};\n  this.base = config.base || AcuityScheduling.base;\n  this.clientId = config.clientId;\n  this.clientSecret = config.clientSecret;\n  this.redirectUri = config.redirectUri;\n  this.accessToken = config.accessToken || null;\n  return this;\n}\n\nAcuitySchedulingOAuth.prototype = Object.create(AcuityScheduling.prototype);\n\nAcuitySchedulingOAuth.prototype.getAuthorizeUrl = function (params) {\n  params = params || {};\n\n  if (!params.scope) {\n    console.error('Missing `scope` parameter.');\n  }\n\n  var query = {\n    response_type: 'code',\n    scope: params.scope,\n    client_id: this.clientId,\n    redirect_uri: this.redirectUri\n  };\n\n  if (params.state) {\n    query.state = params.state;\n  }\n\n  return this.base + '/oauth2/authorize' + '?' + querystring.stringify(query);\n};\n\nAcuitySchedulingOAuth.prototype.authorizeRedirect = function (res, params) {\n  res.writeHead(302, {\n    'location': this.getAuthorizeUrl(params)\n  });\n  res.send();\n};\n\nAcuitySchedulingOAuth.prototype.requestAccessToken = function (code, cb) {\n  var that = this;\n  var options = {\n    headers: {\n      'User-Agent': AcuityScheduling.agent\n    },\n    form: {\n      grant_type: 'authorization_code',\n      code: code,\n      redirect_uri: this.redirectUri,\n      client_id: this.clientId,\n      client_secret: this.clientSecret\n    }\n  };\n  return request.post(this.base + '/oauth2/token', options, function (err, response, body) {\n    if (err) return cb(err);\n    var tokenResponse = JSON.parse(body);\n\n    if (tokenResponse.access_token) {\n      that.accessToken = tokenResponse.access_token;\n    }\n\n    cb(err, tokenResponse);\n  });\n};\n\nAcuitySchedulingOAuth.prototype.isConnected = function () {\n  return this.accessToken ? true : false;\n};\n\nAcuitySchedulingOAuth.prototype.request = function (path, options, cb) {\n  options = options || {};\n  var headers = options.headers = options.headers || {};\n  headers.Authorization = headers.Authorization || 'Bearer ' + this.accessToken;\n  return this._request(path, options, cb);\n};\n\nmodule.exports = AcuitySchedulingOAuth;","map":{"version":3,"sources":["D:/laundry-updateds/node_modules/acuityscheduling/src/AcuitySchedulingOAuth.js"],"names":["AcuityScheduling","require","querystring","request","AcuitySchedulingOAuth","config","base","clientId","clientSecret","redirectUri","accessToken","prototype","Object","create","getAuthorizeUrl","params","scope","console","error","query","response_type","client_id","redirect_uri","state","stringify","authorizeRedirect","res","writeHead","send","requestAccessToken","code","cb","that","options","headers","agent","form","grant_type","client_secret","post","err","response","body","tokenResponse","JSON","parse","access_token","isConnected","path","Authorization","_request","module","exports"],"mappings":"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","sourcesContent":["/**\n * AcuitySchedulingOAuth Class\n */\n\nvar AcuityScheduling = require('./AcuityScheduling');\nvar querystring = require('querystring');\nvar request = require('request');\n\nfunction AcuitySchedulingOAuth (config) {\n\n  config = config || {};\n\n  this.base = config.base || AcuityScheduling.base;\n  this.clientId = config.clientId;\n  this.clientSecret = config.clientSecret;\n  this.redirectUri = config.redirectUri;\n  this.accessToken = config.accessToken || null;\n\n  return this;\n}\n\nAcuitySchedulingOAuth.prototype = Object.create(AcuityScheduling.prototype);\n\nAcuitySchedulingOAuth.prototype.getAuthorizeUrl = function (params) {\n\n  params = params || {};\n\n  if (!params.scope) {\n    console.error('Missing `scope` parameter.');\n  }\n\n  var query = {\n    response_type:  'code',\n    scope:          params.scope,\n    client_id:      this.clientId,\n    redirect_uri:   this.redirectUri\n  };\n\n  if (params.state) {\n    query.state = params.state;\n  }\n\n  return this.base + '/oauth2/authorize' + '?' + querystring.stringify(query);\n};\n\nAcuitySchedulingOAuth.prototype.authorizeRedirect = function (res, params) {\n  res.writeHead(302, {'location': this.getAuthorizeUrl(params)});\n  res.send();\n};\n\nAcuitySchedulingOAuth.prototype.requestAccessToken = function (code, cb) {\n\n  var that = this;\n  var options = {\n    headers: {\n      'User-Agent': AcuityScheduling.agent\n    },\n    form: {\n      grant_type:    'authorization_code',\n      code:          code,\n      redirect_uri:  this.redirectUri,\n      client_id:     this.clientId,\n      client_secret: this.clientSecret\n    }\n  };\n\n  return request.post(this.base + '/oauth2/token', options, function (err, response, body) {\n    if (err) return cb(err);\n    var tokenResponse = JSON.parse(body);\n    if (tokenResponse.access_token) {\n      that.accessToken = tokenResponse.access_token;\n    }\n    cb(err, tokenResponse);\n  });\n};\n\nAcuitySchedulingOAuth.prototype.isConnected = function () {\n  return this.accessToken ? true : false;\n};\n\nAcuitySchedulingOAuth.prototype.request = function (path, options, cb) {\n  options = options || {};\n  var headers = options.headers = options.headers || {};\n  headers.Authorization = headers.Authorization || 'Bearer ' + this.accessToken;\n  return this._request(path, options, cb);\n};\n\nmodule.exports = AcuitySchedulingOAuth;\n"]},"metadata":{},"sourceType":"script"}